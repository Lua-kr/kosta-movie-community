CREATE USER KOSTAMOVIE IDENTIFIED BY KOSTAMOVIE;
GRANT CONNECT, RESOURCE, CREATE VIEW, CREATE SEQUENCE TO KOSTAMOVIE;


--Ouath 테이블
CREATE TABLE OUATHID(
    UID NUMBER(20) PRIMARY KEY,  --고유 번호
    USER_UID NUMBER(20) REFERENCES USERLIST(UID) ON DELETE CASCADE, --고유유저번호
    ACCESS_TOKEN VARCHAR2(255) NOT NULL ,--OUATH 토큰
    PROVIDER VARCHAR2(255) NOT NULL --OUATH 제공자
);
DROP SEQUENCE  OID_SEQ;
CREATE SEQUENCE OID_SEQ NOCACHE;


--관리자 테이블
CREATE TABLE USER_ADMIN(
    AID NUMBER(5) PRIMARY KEY, --고유번호
    USER_UID NUMBER(20) REFERENCES USERLIST(UID) ON DELETE CASCADE --유저 고유 번호
);
DROP SEQUENCE  AID_SEQ;
CREATE SEQUENCE AID_SEQ NOCACHE;


--유저 등급 테이블
CREATE TABLE USER_ROLE(
    URID NUMBER(10) PRIMARY KEY, --등급고유번호
    UR_NAME VARCHAR2(12CHAR) NOT NULL, --등급이름
    REQ_POINT NUMBER(10) DEFAULT 0,--필요포인트
    PRIORITY NUMBER(10) NOT NULL--등급우선순위
);
DROP SEQUENCE  URID_SEQ;
CREATE SEQUENCE URID_SEQ NOCACHE;


--유저 테이블
CREATE TABLE USERLIST(
    UID NUMBER(5) PRIMARY KEY,  --고유유저번호
    ROLE_ID NUMBER(10) REFERENCES USER_ROLE(RID) ON DELETE CASCADE, --등급고유번호
    NICKNAME VARCHAR2(15) NOT NULL ,--닉네임
    EMAIL VARCHAR2(255) NOT NULL, --유저 EMAL
    CREATED_IP VARCHAR2(255) NOT NULL, --유저 IP
    CEATED_DATE DATE NOT NULL, --가입일
    ACCOUNT_LOCKED CHAR(1) DEFAULT '0' , --IP벤 유무
    LAST_UPDATE_DATE DATE NOT NULL, --마지막 접속일
    LAST_UPDATE_IP VARCHAR2(255) NOT NULL, --마지막 접속 IP  
    POINTS NUMBER(100) DEFAULT 0 ,--POINT
    ADULT NUMBER(1) DEFAULT 0, --성인열람
    BDAY DATE NOT NULL --생년월일
);
DROP SEQUENCE UID_SEQ;
CREATE SEQUENCE UID_SEQ NOCACHE;


--파일 테이블
CREATE TABLE UPLOADFILE(
    FID NUMBER(10) PRIMARY KEY,  --파일번호
    USER_UID NUMBER(5) REFERENCES USERLIST(UID) ON DELETE CASCADE, --업로더 고유아이디
    FNAME VARCHAR2(128) NOT NULL,--파일면
    FSIZE NUMBER(10) NOT NULL,--파일 BYTE 크기
    FTYPE VARCHAR2(128) NOT NULL, --파일 형식
    UPLOAD_DATE DATE DEFAULT SYSDATE,--업로드일
    IMG_HSEIGHT NUMBER(6) DEFAULT 0,--이미지 높이
    IMG_WIDTH NUMBER(6) DEFAULT 0--이미지 넓이
);
DROP SEQUENCE  FID_SEQ;
CREATE SEQUENCE FID_SEQ NOCACHE;

--포인트 샵 테이블
CREATE TABLE POINT_SHOP(
    PID NUMBER(20) PRIMARY KEY,--아이템 고유번호
    INAME VARCHAR2(255) NOT NULL,--아이템이름
    ITYPE VARCHAR2(255) NOT NULL,--아이템종류
    IPOINT NUMBER(10) NOT NULL,--요구 포인트
    STOCK NUMBER(10) NOT NULL,--아이템 수량
    FID NUMBER(10) REFERENCES UPLOADFILE(FID) ON DELETE CASCADE, --파일번호
    REQ_ROLE_ID NUMBER(10) REFERENCES USER_ROLE(URID) ON DELETE CASCADE,--등급고유번호
    ILOCKED NUMBER(1) DEFAULT 0--아이템잠금여부
);
DROP SEQUENCE  PID_SEQ;
CREATE SEQUENCE PID_SEQ NOCACHE;


--게시글 업로드 테이블
CREATE TABLE FORUM_UPLOAD(
    FUID NUMBER(10) PRIMARY KEY, --고유번호
    THREAD_ID NUMBER(10) REFERENCES FORUM_THREAD(FTID) ON DELETE CASCADE, --글번호
    FID NUMBER(10) REFERENCES UPLOADFILE(FID) ON DELETE CASCADE--파일번호
);
DROP SEQUENCE  FUID_SEQ;
CREATE SEQUENCE FUID_SEQ NOCACHE;


--게시글 테이블
CREATE TABLE FORUM_THREAD(
    FTID NUMBER(10) PRIMARY KEY, --글번호
    COUNT_READ NUMBER(10) DEFAULT 0, --읽은횟수
    COUNT_POSRT NUMBER(10) DEFAULT 0, --댓글수
    AUTHOR_ID NUMBER(10) REFERENCES USERLIST(UID) ON DELETE CASCADE, --작성자 고유아이디
    THREAD_LOCKED NUMBER(1) DEFAULT 0,--글 잠금여부
    POST_LOCKED NUMBER(1) DEFAULT 0, --댓글 잠금여부
    VOTE NUMBER(10) DEFAULT 0,--찬성/반대 점수
    TEXT VARCHAR2(512) NOT NULL, --글 내용
    TITLE VARCHAR2(2128) NOT NULL,--글 제목
    TIMEDATE DATE DEFAULT SYSDATE   --날짜
);
DROP SEQUENCE  FTID_SEQ;
CREATE SEQUENCE FTID_SEQ NOCACHE;


--댓글 테이블
CREATE TABLE FORUM_POST(
    FPID NUMBER(10) PRIMARY KEY, --댓글번호
    TEXT VARCHAR2(512) NOT NULL,--댓글내용
    THREAD_ID NUMBER(10) REFERENCES FORUM_THREAD(FTID) ON DELETE CASCADE,--글번호
    AUTHOR_ID NUMBER(10) REFERENCES USERLIST(UID) ON DELETE CASCADE,--댓글작성자 고유아이디
    VOTE NUMBER(10) DEFAULT 0, --찬성/반대 점수
    TIMEDATE DATE DEFAULT SYSDATE--날자
);
DROP SEQUENCE  FPID_SEQ;
CREATE SEQUENCE FPID_SEQ NOCACHE;


--글 카테고리 테이블
CREATE TABLE FORUM_CATEGORY(
    FCID NUMBER(10) PRIMARY KEY, --카테고리 번호
    REQ_READ NUMBER(10) REFERENCES USER_ROLE(UR_NAME) ON DELETE CASCADE, --읽기 권한 요구 등급
    REQ_WRITE NUMBER(10) REFERENCES USER_ROLE(UR_NAME) ON DELETE CASCADE,--쓰기 권한 요구 등급
    GUEST VARCHAR2(1) DEFAULT 0 --손님 보기 허용 여부
);
DROP SEQUENCE  FCID_SEQ;
CREATE SEQUENCE FCID_SEQ NOCACHE;

--영화 리뷰 테이블
CREATE TABLE FORUM_REVIEW(
    FRID NUMBER(10) PRIMARY KEY, --고유번호
    THREAD_ID NUMBER(10) REFERENCES FORUM_THREAD(FTID) ON DELETE CASCADE, --글번호
    MOVIE_ID NUMBER(10),--영화 고유 아이디
    RATE NUMBER(4) DEFAULT 0.5 --평점
);
DROP SEQUENCE  FRID_SEQ;
CREATE SEQUENCE FRID_SEQ NOCACHE;

--댓글의 댓글 테이블
CREATE TABLE FORUM_VOTE(
 FVID NUMBER(10) PRIMARY KEY, --고유번호
 USER_ID REFERENCES USERLIST(UID) ON DELETE CASCADE,--유저고유아이디
 CONTENT_ID NUMBER(10),--참조 글번호
 FTYPE NUMBER(5) DEFAULT 0,--참조 글 타입(1 :글  2:댓글)
 VOTE NUMBER(1) DEFAULT 0,-- 0:중립(취소) 1 :찬성  -1 : 반대
 TIMEDATE DATE DEFAULT SYSDATE --날짜
);
DROP SEQUENCE  FVID_SEQ;
CREATE SEQUENCE FVID_SEQ NOCACHE;


-- 쪽지 테이블
CREATE TABLE NOTIFICATE(
    NID NUMBER(10) PRIMARY KEY,--고유번호
    SENDER_ID NUMBER(10) REFERENCES USERLIST(UID) ON DELETE CASCADE, --송신자 고유 아이디
    RECEIVER_ID NUMBER(10) REFERENCES USERLIST(UID) ON DELETE CASCADE,--수신자 고유 아이디
    CONTENT_ID NUMBER(10) NOT NULL,--참조 글번호
    NTYPE NUMBER(5) DEFAULT 0, --참조 글 타입(0 :쪽지  1: 글  2:댓글 )
    TIMEDATE DATE DEFAULT SYSDATE, --날짜
    NREAD NUMBER(1) DEFAULT 0 --알람여부
);
DROP SEQUENCE  NID_SEQ;
CREATE SEQUENCE NID_SEQ NOCACHE;


--영화 테이블
CREATE TABLE MOVIE(
    MID NUMBER(10) PRIMARY KEY, --영화 고유 아이디
    LAST_UPDATE DATE DEFAULT SYSDATE,-- 테이블 마지막 업데이트일
    TITLE VARCHAR2(255) NOT NULL,--원문제목
    TITLE_KOR VARCHAR2(512)  ,--국문제목
    PRODUCT_YEAR NUMBER(12),--제작년도
    OPEN_DATE DATE,--개봉일
    COUNTRY VARCHAR2(64),--국가
    GENRE VARCHAR2(512),--장르
    DIRECTOR VARCHAR2(128),--감독
    VOTE NUMBER(4),--평점
    VOTE_COUNT NUMBER(10) NOT NULL, --평점된 횟수
    BUDGET NUMBER(10),--제작 예산
    ADULT NUMBER(1) DEFAULT 0,--성인여부
    RUN_TIME NUMBER(6) NOT NULL--상영시간
);
DROP SEQUENCE  MID_SEQ;
CREATE SEQUENCE MID_SEQ NOCACHE;


-- 관람 여부 테이블
CREATE TABLE LIST_WATCH(
    LID NUMBER(10) PRIMARY KEY, --고유번호
    UID NUMBER(10) REFERENCES USERLIST(UID) ON DELETE CASCADE, --유저 고유 아이디
    MOVIE_ID NUMBER(10) REFERENCES MOVIE(MID) ON DELETE CASCADE,--영화 고유 아이디
    ADD_DATE DATE DEFAULT SYSDATE,--추가 날짜
    WATCH NUMBER91) DEFAULT 0--관람 여부
);
DROP SEQUENCE  LID_SEQ;
CREATE SEQUENCE LID_SEQ NOCACHE;


--즐겨찾기
CREATE TABLE LIST_FAVORITE(
    LFID NUMBER(5) PRIMARY KEY, --고유번호
    UID NUMBER(20) REFERENCES USERLIST(UID) ON DELETE CASCADE --유저 고유 아이디
    MOVIE_ID NUMBER(10) REFERENCES MOVIE(MID ON DELETE CASCADE), --영화 고유 아이디
    ADD_DATE DATE DEFAULT SYSDATE--추가날짜
);
DROP SEQUENCE  LFID_SEQ;
CREATE SEQUENCE LFID_SEQ NOCACHE;










